# LAMA.fitter

[Назад к списку компонентов](../README.md)

## Назначение

Компонент предназначен для обучения моделей машинного обучения с использованием фреймворка **LightAutoML** (LAMA) на произвольном наборе данных. LightAutoML автоматически создает ансамбль высококачественных моделей, включающих линейные модели и модели градиентного бустинга (LightGBM, CatBoost), с продвинутой обработкой данных и оптимизацией гиперпараметров.

Если на второй входной порт **Тестовая выборка** подан набор данных, то к нему будет применена построенная модель.

Обученная модель может быть сохранена в сериализованный объект Python, после чего использоваться для прогона в компоненте **LAMA.Scorer**. Компонент автоматически генерирует подробные отчеты с важностью признаков и метриками качества.

## Входные порты

| Название                | Тип        | Описание                            |
|:------------------------|:-----------|:------------------------------------|
| Обучающая выборка       | Таблица    |                                     |
| Тестовая выборка        | Таблица    | Необязательный входной набор данных |
| Входные переменные      | Переменные |                                     |

### Структура таблицы "Обучающая выборка"

На вход можно подать данные любой структуры. LightAutoML автоматически определяет типы признаков (числовые, категориальные, даты) и применяет соответствующую обработку. Столбцы, которые не планируется использовать при обучении, должны быть указаны в переменной **Игнорируемые поля**, за исключением идентификатора объекта.

### Структура таблицы "Тестовая выборка"

На вход можно подать данные любой структуры, но структура должна совпадать с набором данных в порте **Обучающая выборка**.

### Переменные в порте "Входные переменные"

| №  | Метка                         | Тип                                   | Значение по умолчанию  |
|:---|:------------------------------|:--------------------------------------|:-----------------------|
| 1  | Виртуальное окружение         | ![](./img/string.svg) Строковый       |null                    |
| 2  | Всегда создавать новую папку  | ![](./img/logical.svg) Логический     |true                    |
| 3  | Библиотека для сериализации   | ![](./img/string.svg) Строковый       |null                    |
| 4  | Имя файла                     | ![](./img/string.svg) Строковый       |null                    |
| 5  | Путь к файлу                  | ![](./img/string.svg) Строковый       |null                    |
| 6  | Поле с идентификатором        | ![](./img/string.svg) Строковый       |null                    |
| 7  | Выходное поле с разбиением    | ![](./img/string.svg) Строковый       |null                    |
| 8  | Целевое поле                  | ![](./img/string.svg) Строковый       |null                    |
| 9  | Игнорируемые поля             | ![](./img/string.svg) Строковый       |null                    |
| 10 | Полный выходной набор         | ![](./img/logical.svg) Логический     |true                    |
| 11 | Сохранять метки полей         | ![](./img/logical.svg) Логический     |true                    |
| 12 | Словарь других ролей          | ![](./img/string.svg) Строковый       |null                    |
| 13 | task                          | ![](./img/string.svg) Строковый       |null                    |
| 14 | loss                          | ![](./img/string.svg) Строковый       |null                    |
| 15 | metric                        | ![](./img/string.svg) Строковый       |null                    |
| 16 | timeout                       | ![](./img/integer.svg) Целочисленный  |null                    |
| 17 | cpu_limit                     | ![](./img/integer.svg) Целочисленный  |null                    |
| 18 | reader_params                 | ![](./img/string.svg) Строковый       |null                    |

1. **Виртуальное окружение** — путь к файлу интерпретатора Python для запуска в изолированной среде;
2. **Всегда создавать новую папку** — при значении `True` создается папка с временной меткой формата `ГГГГММДД_ЧЧММСС_lama` для сохранения результатов;
3. **Библиотека для сериализации** — название python-модуля для сохранения объектов. Поддерживается `pickle` и `joblib`;
4. **Имя файла** — имя файла для сохранения обученной модели в виде сериализованного объекта Python;
5. **Путь к файлу** — путь к папке для сохранения модели и отчетов. При пустом значении используется текущая рабочая папка;
6. **Поле с идентификатором** — необязательный столбец с идентификатором объекта, автоматически исключается из обучения;
7. **Выходное поле с разбиением** — имя поля в выходном наборе данных, указывающее принадлежность к обучающему или тестовому множеству;
8. **Целевое поле** — имя поля с целевой переменной для обучения модели;
9. **Игнорируемые поля** — список имен полей (через запятую), которые исключаются из процесса обучения и предсказания;
10. **Полный выходной набор** — при значении `True` включает в выходной набор данных все исходные поля помимо предсказаний;
11. **Сохранять метки полей** — при значении `True` восстанавливает оригинальные метки полей в выходном наборе;
12. **Словарь других ролей** — дополнительные роли признаков в формате словаря Python для тонкой настройки обработки данных;
13. **task** — тип задачи машинного обучения: `binary` для бинарной классификации, `reg` для регрессии, `multiclass` для многоклассовой классификации;
14. **loss** — функция потерь для оптимизации модели. По умолчанию `logloss` для классификации, `mse` для регрессии;
15. **metric** — метрика для оценки качества модели. По умолчанию выбирается автоматически: ROC-AUC для бинарной классификации;
16. **timeout** — максимальное время обучения в секундах. LightAutoML автоматически управляет временем между разными алгоритмами;
17. **cpu_limit** — количество CPU ядер для использования при обучении моделей;
18. **reader_params** — дополнительные параметры для компонента Reader в формате словаря Python, отвечающего за анализ и предобработку данных.

## Выходные порты

| Название              | Тип        |
|:----------------------|:-----------|
| Выходной набор данных | Таблица    |

### Структура таблицы "Выходной набор данных"

В выходной набор данных попадают предсказания модели LightAutoML в столбце `prediction`, а также дополнительные столбцы согласно настройкам:

* Столбец с именем, указанным в переменной **Выходное поле с разбиением**, содержащий метку принадлежности к тестовому множеству;
* При значении **Полный выходной набор** = `True` включаются все исходные поля данных;
* Поле идентификатора (если указано) для связи предсказаний с исходными объектами.

## Автоматическая генерация отчетов

Компонент автоматически создает следующие файлы в указанной папке:

* **console.log** — лог процесса обучения с детальной информацией;
* **model_summary.csv** — сводка модели с метриками качества, количеством записей, типами признаков и описанием ансамбля;
* **fast_feature_importance.png** — график быстрой важности признаков на основе встроенной важности LGBM;
* **permutation_feature_importance.png** — график точной важности признаков на основе permutation importance;
* **HTML отчеты** — подробные интерактивные отчеты, генерируемые системой ReportDeco.