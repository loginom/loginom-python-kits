# curve_fit

[Назад к списку компонентов](../README.md)

## Назначение

Компонент аппроксимирует произвольную функцию экспериментальными данными методом нелинейных наименьших квадратов с помощью [scipy.optimize.curve_fit](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html) из SciPy. Он оценивает параметры модели, строит прогнозы и предоставляет аналитические результаты.

## Входные порты

| Название              | Тип        |
|:----------------------|:-----------|
| Входной набор данных  | Таблица    |
| Переменные            | Переменные |

### Структура таблицы "Входной источник данных"

На вход подается набор данных, содержащий последовательности: значения независимого признака и соответствующие значения зависимого признака. Значения не должны содержать пропусков. Данные должны быть целочисленного или вещественного типа.

## Переменные в порте "Входные переменные"

| №   | Метка                       | Тип                                     | Значение по умолчанию  |
|:----|:----------------------------|:----------------------------------------|:-----------------------|
| 1   | Формула модели                | ![](./img/string.svg) Строковый         |null                  |
| 2   | Список параметров модели      | ![](./img/string.svg) Строковый         |null                  |
| 3   | Начальные значения параметров | ![](./img/string.svg) Строковый         |null                  |
| 4   | Метод оптимизации             | ![](./img/string.svg) Строковый         |null                    |
| 5   | Границы параметров            | ![](./img/string.svg) Строковый         |null                    |
| 6   | Тип выходных данных           | ![](./img/string.svg) Строковый         |null                    |
| 7   | Количество периодов прогноза  | ![](./img/realnumber.svg) Вещественный  |null                    |

1. **Формула модели**  — строка с математическим выражением, описывающим модель как функцию признаков входных данных и параметров (например, "a * np.exp(-b * x) + c"). Обязательный параметр. 
2. **Список параметров модели**  — строка с перечислением имён параметров через запятую, где первый параметр — имя признака входных данных (например, "x,a,b,c"). Обязательный параметр.
3. **Начальные значения параметров** — строка с числовыми значениями, разделёнными запятыми, задающими стартовые оценки параметров (без учёта первого признака). Если не указано, используются единицы по умолчанию.
4. **Метод оптимизации**  — строка, определяющая алгоритм оптимизации: одна из "lm", "trf", "dogbox". По умолчанию "trf".
5. **Границы параметров**  — строка, преобразуемая в список пар с нижними и верхними границами для всех параметров (например, "(0,1), (0,5), (-np.inf,np.inf)"). Частичное указание границ не допускается — необходимо задать диапазон для каждого параметра. Если не указано, границы для всех параметров считаются неограниченными (-inf до inf).
6. **Тип выходных данных**  — ожидается строка с одним из вариантов:
* popt — оптимальные параметры (по умолчанию);
* pcov — ковариационная матрица;
* pred — предсказанные значения.
7. **Количество периодов прогноза**  — ожидается число (целое, неотрицательное), указывающее, на сколько периодов вперед делать прогноз.
Значение по умолчанию: 0 (прогноз не строится, выводятся только данные из истории).

## **Выходные порты**

| Название              | Тип        |
|:----------------------|:-----------|
| Выходной набор данных | Таблица    |

Структура выходного набора данных зависит от значения переменной *Тип выходных данных*.

### **Структура таблицы "Выходной набор данных — Оптимальные параметры"**

Если значение переменной **Тип выходных данных** равно **popt** или **не задано (null)**, выходной набор данных будет содержать оптимальные параметры, полученные в результате подбора модели.

| Метка         | Тип                                    | Описание      |
|:--------------|:---------------------------------------|:--------------|
| Parameter     | ![](./img/string.svg) Строковый        | Название параметра модели, для которого выполнена оценка     |
| Estimate      | ![](./img/realnumber.svg) Вещественный | Оценённое оптимальное значение параметра              |
| Lower Bound   | ![](./img/realnumber.svg) Вещественный | Нижняя граница диапазона параметра, использованная при оптимизации       |
| Upper Bound   | ![](./img/realnumber.svg) Вещественный | Верхняя граница диапазона параметра, использованная при оптимизации      |
| Initial Value | ![](./img/realnumber.svg) Вещественный | Начальное значение параметра, с которого начинался процесс оптимизации   |

### **Структура таблицы "Выходной набор данных — Ковариационная матрица"**

Если значение переменной **Тип выходных данных** равно **pcov**, выходной набор данных будет представлен в виде таблицы, строки и столбцы которой соответствуют именам параметров, а значения — элементам ковариационной матрицы, полученной в процессе подбора модели.

### Структура таблицы "Выходной набор данных — Предсказанные значения"

Если значение переменной **Тип выходных данных** равно **pred**, выходной набор данных будет представлен в виде таблицы, содержащей исходные и прогнозные значения признаков, где столбец **Predicted_Y** отображает рассчитанные моделью значения для заданных и будущих периодов.

Метка         | Тип                                    | Описание      |
|:--------------|:---------------------------------------|:--------------|
| X   | ![](./img/string.svg) Вещественный       | Исторические входные данные для независимого признака X      |
| Y      | ![](./img/realnumber.svg) Вещественный | Соответствующие значения Y для зависимого признака          |
| Predicted_Y  | ![](./img/realnumber.svg) Вещественный | Предсказанные значения для зависимой переменной. Количество значений рассчитанных в этом поле соответствуют количество периодов прогноза в переменной — num_period|